<!DOCTYPE html>
<html>
<head>
  <title>Add Face â€“ Live Capture</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<nav class="navbar navbar-dark bg-dark px-3">
  <span class="navbar-brand">ðŸ“¸ Live Face Capture</span>
  <a href="/faces" class="btn btn-sm btn-light">Back</a>
</nav>

<div class="container mt-4">

  <div class="card shadow-lg mx-auto" style="max-width: 520px;">
    <div class="card-body">

      <h5 class="text-center mb-3">Capture 10 Face Images</h5>

      <div class="mb-3">
        <label class="form-label">Person Name</label>
        <input id="name" class="form-control" placeholder="Enter name">
      </div>

      <div class="text-center mb-3">
        <video id="video" autoplay playsinline
               class="rounded border"
               style="width:100%; max-height:300px;"></video>
      </div>

      <div class="alert alert-info text-center py-2">
        Keep your face steady for <b>2 seconds</b><br>
        10 images will be captured automatically
      </div>

      <div class="d-grid">
        <button class="btn btn-primary btn-lg"
                onclick="startCapture()">
          ðŸ“· Start Capture
        </button>
      </div>

      <form method="POST" enctype="multipart/form-data" id="form">
        <input type="hidden" name="name" id="hiddenName">
      </form>

    </div>
  </div>

</div>

<script>
const video = document.getElementById("video");
const form = document.getElementById("form");
const hiddenName = document.getElementById("hiddenName");

navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => video.srcObject = stream)
  .catch(() => alert("Camera access blocked. Use localhost or HTTPS"));

function startCapture() {
  const name = document.getElementById("name").value.trim();
  if (!name) {
    alert("Please enter name");
    return;
  }

  hiddenName.value = name;
  let count = 0;

  const interval = setInterval(() => {
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);

    canvas.toBlob(blob => {
      const file = new File([blob], `img_${count+1}.jpg`, { type: "image/jpeg" });

      const input = document.createElement("input");
      input.type = "file";
      input.name = "images";

      const dt = new DataTransfer();
      dt.items.add(file);
      input.files = dt.files;

      form.appendChild(input);
    }, "image/jpeg");

    count++;
    if (count === 10) {
      clearInterval(interval);
      setTimeout(() => form.submit(), 500);
    }
  }, 200);
}
</script>

</body>
</html>
